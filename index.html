<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CopyMaster ‚Äî Panel</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        .container {
            max-width: 1100px;
        }

        h1,
        h3,
        h4 {
            color: #0f9d58;
        }

        .card {
            border-radius: 10px;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.15rem;
        }

        .link-success {
            color: #0f9d58 !important;
        }

        .table-actions button {
            margin-right: 6px;
        }

        /* Nuevos estilos para mejoras */
        .stat-card {
            text-align: center;
            padding: 20px;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #0f9d58;
        }

        .stat-card .number {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .stat-card .label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .technician-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #f1f1f1;
        }

        .performance-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .performance-fill {
            height: 100%;
            background-color: #0f9d58;
            border-radius: 5px;
        }

        .dashboard-section {
            margin-bottom: 30px;
        }

        .section-title {
            border-left: 4px solid #0f9d58;
            padding-left: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }
    </style>
    <script>
        const API_BASE = "https://copymasterback.onrender.com";
    </script>
    <script src="assets/js/app.js" defer></script>
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <nav class="navbar navbar-expand-lg navbar-light container">
            <a class="navbar-brand text-success" href="#">
                <i class="fas fa-copy me-1"></i>CopyMaster
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navMenu">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="#" data-page="home.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="machines/list.html">M√°quinas</a></li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="customers/list.html">Clientes</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#"
                            data-page="service_requests/list.html">Solicitudes</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="technicians/list.html">T√©cnicos</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="costs/analysis.html">Costos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="reports/generate.html">Reportes</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-link text-muted text-decoration-none dropdown-toggle" type="button"
                            id="userMenu" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> <span id="current-user"></span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" data-page="user/profile.html"><i
                                        class="fas fa-user me-2"></i>Mi perfil</a></li>
                            <li><a class="dropdown-item" href="#" data-page="user/sessions.html"><i
                                        class="fas fa-clock me-2"></i>Sesiones activas</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#" id="logout"><i
                                        class="fas fa-sign-out-alt me-2"></i>Cerrar sesi√≥n</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main content area -->
    <main class="flex-fill container py-4" id="content-main">
        <!-- Cargado din√°micamente -->
    </main>

    <!-- Footer -->
    <footer class="bg-light text-muted py-3 mt-auto">
        <div class="container d-flex justify-content-between">
            <div>CopyMaster &copy; 2025</div>
            <div class="small">Contacto: soporte@copymaster.local</div>
        </div>
    </footer>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script con todas las mejoras -->
    <script>
        // Servicios corregidos y mejorados


        const customerService = {
            list: () => fetch(API_BASE + "/customers")
                .then(r => r.json())
                .then(res => res.data || []),

            get: (id) => fetch(API_BASE + "/customers/" + id)
                .then(r => r.json())
                .then(res => res.data),

            create: (data) => fetch(API_BASE + "/customers", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            update: (id, data) => fetch(API_BASE + "/customers/" + id, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            delete: (id) => fetch(API_BASE + "/customers/" + id, {
                method: "DELETE"
            }).then(r => r.json()).then(res => res.data)
        };

        const locationService = {
            list: () => fetch(API_BASE + "/locations")
                .then(r => r.json())
                .then(res => res || [])
        };
        const technicianService = {
            list: () => fetch(API_BASE + "/technicians")
                .then(r => r.json()).then(res => res.data || []),

            get: (id) => fetch(API_BASE + "/technicians/" + id)
                .then(r => r.json()).then(res => res.data),

            create: (data) => fetch(API_BASE + "/technicians", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            update: (id, data) => fetch(API_BASE + "/technicians/" + id, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            performance: (id, startDate, endDate) => {
                const params = new URLSearchParams({
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString()
                });
                return fetch(`${API_BASE}/technicians/${id}/performance?${params}`)
                    .then(r => r.json()).then(res => res.data);
            },

            comparison: (startDate, endDate) => {
                const params = new URLSearchParams({
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString()
                });
                return fetch(`${API_BASE}/technicians/comparison?${params}`)
                    .then(r => r.json()).then(res => res.data);
            },

            // üîπ NUEVOS M√âTODOS PARA HOJA DE VIDA
            getPerformance: (id) => fetch(`${API_BASE}/technicians/${id}/performance`)
                .then(r => r.json()).then(res => res.data),

            getStats: (id, startDate, endDate) => {
                const params = new URLSearchParams();
                if (startDate) params.append('startDate', startDate);
                if (endDate) params.append('endDate', endDate);

                return fetch(`${API_BASE}/technicians/${id}/stats?${params}`)
                    .then(r => r.json()).then(res => res.data);
            },

            getRepeatedRequests: (id) => fetch(`${API_BASE}/technicians/${id}/repeated-requests`)
                .then(r => r.json()).then(res => res.data),

            getTimeMetrics: (id) => fetch(`${API_BASE}/technicians/${id}/time-metrics`)
                .then(r => r.json()).then(res => res.data),

            getTimeline: (id, limit = 20) => fetch(`${API_BASE}/technicians/${id}/timeline?limit=${limit}`)
                .then(r => r.json()).then(res => res.data),

            getOpenTasks: (id) => fetch(`${API_BASE}/technicians/${id}/open-tasks`)
                .then(r => r.json()).then(res => res.data),

            // üîπ M√©todo de eliminaci√≥n
            delete: (id) => fetch(`${API_BASE}/technicians/${id}`, {
                method: "DELETE"
            }).then(r => r.json()).then(res => res.data)


        };


        const technicianPerformanceService = {
            getPerformance: (id) => fetch(`${API_BASE}/technicians/${id}/performance`)
                .then(r => r.json()).then(res => res.data),

            getStats: (id, startDate, endDate) => {
                const params = new URLSearchParams();
                if (startDate) params.append('startDate', startDate);
                if (endDate) params.append('endDate', endDate);

                return fetch(`${API_BASE}/technicians/${id}/stats?${params}`)
                    .then(r => r.json()).then(res => res.data);
            },

            getRepeatedRequests: (id) => fetch(`${API_BASE}/technicians/${id}/repeated-requests`)
                .then(r => r.json()).then(res => res.data),

            getTimeMetrics: (id) => fetch(`${API_BASE}/technicians/${id}/time-metrics`)
                .then(r => r.json()).then(res => res.data),

            getTimeline: (id, limit = 20) => fetch(`${API_BASE}/technicians/${id}/timeline?limit=${limit}`)
                .then(r => r.json()).then(res => res.data),

            getOpenTasks: (id) => fetch(`${API_BASE}/technicians/${id}/open-tasks`)
                .then(r => r.json()).then(res => res.data)
        };

        const machineService = {
            list: () => fetch(API_BASE + "/machines")
                .then(r => r.json()).then(res => res.data || []),

            get: (id) => fetch(API_BASE + "/machines/" + id)
                .then(r => r.json())
                .then(res => {
                    // Si la respuesta tiene propiedad 'data', usarla
                    if (res && res.data !== undefined) {
                        return res.data;
                    }
                    // Si no, asumir que la respuesta es directamente los datos
                    return res;
                }),

            create: (data) => fetch(API_BASE + "/machines", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(async r => {
                if (!r.ok) {
                    const text = await r.text();
                    throw new Error("Error en backend: " + text);
                }
                return r.json();
            }).then(res => res.data),
            update: (id, data) => fetch(API_BASE + "/machines/" + id, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            delete: (id) => fetch(API_BASE + "/machines/" + id, {
                method: "DELETE"
            }).then(r => r.json()).then(res => res.data),

            movements: (id) => fetch(API_BASE + "/machine-movements?machineId=" + id)
                .then(r => r.json()).then(res => res.data || []),

            meterReadings: (id) => fetch(API_BASE + "/meter-readings/machine/" + id)
                .then(r => r.json()).then(res => res.data || []),

            tonerReadings: (id) => fetch(API_BASE + "/reading-toner/machine/" + id)
                .then(r => {
                    console.log("Response status:", r.status);
                    console.log("Response headers:", r.headers);
                    return r.json();
                })
                .then(res => {
                    console.log("Response JSON:", res);
                    return res.data || [];
                })
                .catch(err => {
                    console.error("Error fetching toner readings:", err);
                    return [];
                }),

            search: (query) => fetch(API_BASE + "/machines/search?q=" + encodeURIComponent(query))
                .then(r => r.json()).then(res => res.data || [])
        };

        const serviceRequestService = {
            list: () => fetch(API_BASE + "/service-requests")
                .then(r => r.json()).then(res => res.data || []),

            get: (id) => fetch(API_BASE + "/service-requests/" + id)
                .then(r => r.json()).then(res => res.data),

            create: (data) => fetch(API_BASE + "/service-requests", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            update: (id, data) => fetch(API_BASE + "/service-requests/" + id, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            byCustomer: (customerId) => fetch(API_BASE + "/service-requests/customer/" + customerId)
                .then(r => r.json()).then(res => res.data || []),

            byMachine: (machineId) => fetch(API_BASE + "/service-requests/machine/" + machineId)
                .then(r => r.json()).then(res => res.data || [])
        };

        const rootCauseService = {
            // Obtener todas las causas agrupadas por categor√≠a
            getGrouped: () => fetch(API_BASE + "/root-causes/grouped")
                .then(r => r.json())
                .then(res => res.data || {}),

            // Obtener todas las causas
            getAll: () => fetch(API_BASE + "/root-causes")
                .then(r => r.json())
                .then(res => res.data || []),

            // Obtener por categor√≠a
            getByCategory: (category) => fetch(API_BASE + "/root-causes/by-category?category=" + encodeURIComponent(category))
                .then(r => r.json())
                .then(res => res.data || []),

            // Obtener todas las categor√≠as
            getCategories: () => fetch(API_BASE + "/root-causes/categories")
                .then(r => r.json())
                .then(res => res.data || []),

            // Obtener una causa por ID
            getById: (id) => fetch(API_BASE + "/root-causes/" + id)
                .then(r => r.json())
                .then(res => res.data)
        };


        const serviceVisitService = {
            list: () => fetch(API_BASE + "/visits/")
                .then(r => r.json()).then(res => res.data || []),

            get: (id) => fetch(API_BASE + "/visits/" + id)
                .then(r => r.json()).then(res => res.data),

            create: (data) => fetch(API_BASE + "/visits", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            update: (id, data) => fetch(API_BASE + "/visits/" + id, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            byRequest: (requestId) => fetch(API_BASE + "/visits/request/" + requestId)
                .then(r => r.json()).then(res => {
                    // Si tu backend devuelve array directamente
                    if (Array.isArray(res)) return res;
                    // Si devuelve ServerResponseDto con data
                    return res.data || [];
                }),

            byTechnician: (technicianId) => fetch(API_BASE + "/service-visits/technician/" + technicianId)
                .then(r => r.json()).then(res => res.data || [])
        };



        const readingTonerService = {
            getByMachine: (machineId) => fetch(`${API_BASE}/reading-toner/machine/${machineId}`)
                .then(r => r.json()).then(res => res.data),

            create: (data) => fetch(`${API_BASE}/reading-toner`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            update: (id, data) => fetch(`${API_BASE}/reading-toner/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data)
        };

        const meterReadingService = {
            getByMachine: (machineId) => fetch(`${API_BASE}/meter-readings/machine/${machineId}`)
                .then(r => r.json()).then(res => res.data),

            create: (data) => fetch(`${API_BASE}/meter-readings`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data)
        };




        const costService = {
            analysis: (startDate, endDate) => {
                const params = new URLSearchParams({
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString()
                });
                return fetch(`${API_BASE}/costs/analysis?${params}`)
                    .then(r => r.json()).then(res => res.data);
            },
            comparison: (months) => fetch(`${API_BASE}/costs/comparison?months=${months}`)
                .then(r => r.json()).then(res => res.data || [])
        };

        const reportService = {
            generate: (type, params) => fetch(`${API_BASE}/reports/generate`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type, params })
            }).then(r => r.json()).then(res => res.data),

            list: () => fetch(API_BASE + "/reports")
                .then(r => r.json()).then(res => res.data || [])
        };

        const userService = {
            getProfile: () => fetch(API_BASE + "/user/profile")
                .then(r => r.json()).then(res => res.data),

            updateProfile: (data) => fetch(API_BASE + "/user/profile", {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(r => r.json()).then(res => res.data),

            getSessions: () => fetch(API_BASE + "/user/sessions")
                .then(r => r.json()).then(res => res.data || []),

            terminateSession: (sessionId) => fetch(API_BASE + `/user/sessions/${sessionId}`, {
                method: "DELETE"
            }).then(r => r.json()).then(res => res.data)
        };

        // Funciones de utilidad
        function showAlert(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `alert alert-${type} alert-dismissible fade show`;
            div.innerHTML = `
                ${msg}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.getElementById('content-main').prepend(div);
            setTimeout(() => {
                if (div.parentNode) {
                    div.remove();
                }
            }, 5000);
        }

        function formatDate(dt) {
            return dt ? new Date(dt).toLocaleString() : '';
        }

        function formatDateOnly(dt) {
            return dt ? new Date(dt).toLocaleDateString() : '';
        }

        // C√≥digo principal de la aplicaci√≥n
        document.addEventListener("DOMContentLoaded", () => {
            // Verificar autenticaci√≥n
            const user = localStorage.getItem("user");
            if (!user) {
                window.location = "login.html";
                return;
            }

            const userObj = JSON.parse(user);
            document.getElementById("current-user").innerText = userObj.username || userObj.fullName || "";

            // Configurar sistema de navegaci√≥n
            /*window.appLoad = async function (path) {
                 try {
 
                         
                     const res = await fetch(path);
                     if (!res.ok) throw new Error("No se pudo cargar " + path);
 
                     const html = await res.text();
                     document.getElementById("content-main").innerHTML = html;
 
                     // Ejecutar scripts incrustados
                     const tmp = document.createElement('div');
                     tmp.innerHTML = html;
                     tmp.querySelectorAll('script').forEach(s => {
                         const script = document.createElement('script');
                         if (s.src) {
                             script.src = s.src;
                         } else {
                             script.textContent = s.textContent;
                         }
                         document.body.appendChild(script);
                     });
                 } catch (e) {
                     console.error(e);
                     document.getElementById("content-main").innerHTML = `
                         <div class="alert alert-danger">
                             <h5>Error al cargar la p√°gina</h5>
                             <p>${e.message}</p>
                             <a href="#" onclick="appLoad('home.html')" class="btn btn-sm btn-success">Volver al inicio</a>
                         </div>
                     `;
                 }
             };*/






            /*window.appLoad = async function (path) {
                try {
                    // Mostrar indicador de carga
                    document.getElementById("content-main").innerHTML = `
             <div class="text-center py-5">
                 <div class="spinner-border text-success" role="status">
                     <span class="visually-hidden">Cargando...</span>
                 </div>
                 <p class="mt-3">Cargando...</p>
             </div>
         `;

                    const res = await fetch(path);
                    if (!res.ok) throw new Error("No se pudo cargar " + path);

                    const html = await res.text();
                    document.getElementById("content-main").innerHTML = html;

                    // Ejecutar scripts incrustados de manera segura
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const scripts = doc.querySelectorAll('script');

                    for (const script of scripts) {
                        if (script.src) {
                            // Script externo
                            const newScript = document.createElement('script');
                            newScript.src = script.src;
                            document.head.appendChild(newScript);
                        } else {
                            // Script inline
                            try {
                                // Usar Function para evitar problemas de contexto
                                new Function(script.textContent)();
                            } catch (e) {
                                console.warn("Error ejecutando script:", e);
                            }
                        }
                    }

                    // Forzar la ejecuci√≥n de scripts que usan DOMContentLoaded
                    window.dispatchEvent(new Event('DOMContentLoaded'));

                } catch (e) {
                    console.error(e);
                    document.getElementById("content-main").innerHTML = `
             <div class="alert alert-danger">
                 <h5>Error al cargar la p√°gina</h5>
                 <p>${e.message}</p>
                 <a href="#" onclick="appLoad('home.html')" class="btn btn-sm btn-success">Volver al inicio</a>
             </div>
         `;
                }
            };*/



            window.appLoad = async function (path) {
                try {
                    console.log("üìÇ Cargando p√°gina:", path);

                    // Mostrar indicador de carga
                    document.getElementById("content-main").innerHTML = `
            <div class="text-center py-5">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-3">Cargando ${path}...</p>
            </div>
        `;

                    const res = await fetch(path);
                    if (!res.ok) throw new Error("No se pudo cargar " + path);

                    const html = await res.text();
                    document.getElementById("content-main").innerHTML = html;

                    console.log("‚úÖ HTML cargado:", path);

                    // üö® IMPORTANTE: EJECUTAR SCRIPTS DE FORMA SEGURA
                    // Extraer scripts del HTML cargado
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    const scripts = tempDiv.querySelectorAll('script');

                    // Ejecutar scripts en orden
                    for (const script of scripts) {
                        if (script.src) {
                            // Script externo - ignorar por ahora o cargar de forma controlada
                            console.log("‚ö†Ô∏è Script externo encontrado:", script.src);
                            // Puedes cargarlo si es necesario, pero cuidado con dependencias
                        }

                        if (script.textContent.trim()) {
                            // Script inline - ejecutar de forma controlada
                            try {
                                const code = script.textContent;

                                // üö´ EVITAR ejecutar c√≥digo problem√°tico
                                const problematicPatterns = [
                                    'DOMContentLoaded',
                                    'addEventListener.*DOMContentLoaded',
                                    'document.addEventListener.*DOMContentLoaded',
                                    'initDashboardEvents',
                                    'a\\[data-page\\]',
                                    'appLoad.*data-page',
                                    'querySelectorAll.*data-page'
                                ];

                                let shouldExecute = true;
                                for (const pattern of problematicPatterns) {
                                    if (new RegExp(pattern, 'i').test(code)) {
                                        console.log("üö´ Script contiene c√≥digo problem√°tico, omitiendo");
                                        shouldExecute = false;
                                        break;
                                    }
                                }

                                if (shouldExecute) {
                                    // Usar Function para crear un contexto aislado
                                    const executeScript = new Function(code);
                                    executeScript();
                                }
                            } catch (e) {
                                console.warn("‚ö†Ô∏è Error ejecutando script:", e.message);
                            }
                        }
                    }

                    console.log("üéâ P√°gina cargada completamente:", path);

                } catch (e) {
                    console.error("‚ùå Error en appLoad:", e);
                    document.getElementById("content-main").innerHTML = `
            <div class="alert alert-danger">
                <h5>Error al cargar la p√°gina</h5>
                <p>${e.message}</p>
                <button onclick="appLoad('home.html')" class="btn btn-sm btn-success">Volver al inicio</button>
            </div>
        `;
                }
            };









            // Configurar eventos de navegaci√≥n
            /*document.querySelectorAll('a[data-page]').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    appLoad(a.dataset.page);
                });
            });*/



            // SOLUCI√ìN SIMPLE Y SEGURA PARA NAVEGACI√ìN
            // Solo un event listener en el body
            let navigationInitialized = false;

            function setupNavigation() {
                if (navigationInitialized) return;

                document.body.addEventListener('click', function (e) {
                    // Buscar si el click fue en un elemento con data-page
                    const element = e.target.closest('[data-page]');

                    if (element && element.hasAttribute('data-page')) {
                        e.preventDefault();
                        e.stopPropagation();

                        const page = element.getAttribute('data-page');
                        console.log("üîó Navegando a:", page);

                        // Peque√±o delay para evitar m√∫ltiples clics
                        if (!element.classList.contains('clicked')) {
                            element.classList.add('clicked');
                            setTimeout(() => {
                                element.classList.remove('clicked');
                            }, 1000);

                            appLoad(page);
                        }
                        return false;
                    }
                }, true); // Usar captura para manejar mejor los eventos

                navigationInitialized = true;
                console.log("‚úÖ Navegaci√≥n configurada");
            }

            // Llamar a setupNavigation despu√©s de que el DOM est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupNavigation);
            } else {
                setupNavigation();
            }


            // Configurar logout
            document.getElementById("logout").addEventListener("click", () => {
                localStorage.removeItem("user");
                window.location = "login.html";
            });

            // Cargar p√°gina inicial
            appLoad('home.html');
        });
    </script>
</body>

</html>