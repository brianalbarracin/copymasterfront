<div class="card p-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Clientes</h4>
    <button class="btn btn-success btn-sm" onclick="appLoad('customers/create.html')">
      <i class="fas fa-plus me-1"></i> Nuevo Cliente
    </button>
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>NIT</th>
          <th>Nombre</th>
          <th>Contacto</th>
          <th>Teléfono</th>
          <th>Email</th>
          <th>Dirección</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="customers-tbody">
        <tr><td colspan="8" class="text-center">Cargando...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
    async function loadCustomers(){
        try {
            const customers = await customerService.list();
            const tbody = document.getElementById("customers-tbody");
            tbody.innerHTML = "";

            if(customers.length === 0){
                tbody.innerHTML = `<tr><td colspan="8" class="text-center text-muted">No hay clientes</td></tr>`;
                return;
            }

            customers.forEach(c => {
                tbody.innerHTML += `
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.nit || ""}</td>
                        <td>${c.name || ""}</td>
                        <td>${c.contactName || ""}</td>
                        <td>${c.phone || ""}</td>
                        <td>${c.email || ""}</td>
                        <td>${c.address || ""}</td>
                        <td class="table-actions text-end">
                            <button class="btn btn-sm btn-info" onclick="loadCustomerDetail(${c.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="appLoad('customers/edit.html?id=${c.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${c.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        } catch (err) {
            console.error("Error loading customers:", err);
            showAlert("Error cargando clientes: " + err.message, "danger");
        }
    }

    async function deleteCustomer(id){
        if(!confirm("¿Seguro que quieres eliminar este cliente?")) return;
        try {
            await customerService.delete(id);
            showAlert("Cliente eliminado","success");
            loadCustomers();
        } catch(err){
            showAlert("Error eliminando: " + err.message,"danger");
        }
    }

    function loadCustomerDetail(id) {
        sessionStorage.setItem('selectedCustomerId', id);
        appLoad('customers/detail.html');
    }


    // Autoejecutar inmediatamente cuando el snippet se inyecta
    (async function(){
        await loadCustomers();
    })();
</script>