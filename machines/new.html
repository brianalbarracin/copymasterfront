<div class="card p-3">
  <h4>Crear M√°quina</h4>
  <form id="form-create-machine" class="row g-3 needs-validation" novalidate>
    <div class="col-md-6">
      <label class="form-label">Serial (companySerial) *</label>
      <input class="form-control" name="companySerial" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">N√∫mero (companyNumber)</label>
      <input class="form-control" name="companyNumber">
    </div>

    <div class="col-md-4">
      <label class="form-label">Modelo *</label>
      <input class="form-control" name="model" required>
    </div>
    <div class="col-md-4">
      <label class="form-label">Marca</label>
      <input class="form-control" name="brand">
    </div>
    <div class="col-md-2">
      <label class="form-label">A√±o</label>
      <input type="number" class="form-control" name="year">
    </div>

    <div class="col-12">
      <label class="form-label">Notas de la m√°quina</label>
      <textarea class="form-control" name="notes" rows="2"></textarea>
    </div>

    <!-- üîπ Campos para la lectura inicial -->
    <div class="col-md-6">
      <label class="form-label">Lectura inicial *</label>
      <input type="number" class="form-control" name="initialReading" required value="0">
    </div>
    <div class="col-md-6">
      <label class="form-label">Notas de lectura</label>
      <input class="form-control" name="readingNotes" placeholder="Ej: Lectura inicial al instalar">
    </div>

    <!-- üîπ Selector de estado -->
    <div class="col-md-6">
      <label class="form-label">Estado</label>
      <select class="form-select" name="status" required>
        <option value="BODEGA" selected>Bodega</option>
        <option value="INSTALADA">Instalada</option>
        <option value="MANTENIMIENTO">Mantenimiento</option>
        <option value="RETIRADA">Retirada</option>
      </select>
    </div>

    <div class="col-12">
      <button class="btn btn-success" type="submit">Crear</button>
      <button class="btn btn-outline-secondary" type="button" onclick="appLoad('machines/list.html')">Cancelar</button>
    </div>
  </form>
</div>

<script>
document.getElementById("form-create-machine").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;

  if (!form.checkValidity()) {
    form.classList.add('was-validated');
    return;
  }

  const data = Object.fromEntries(new FormData(form));

  // Convertir valores num√©ricos
  if (data.year) data.year = parseInt(data.year);
  if (data.initialReading) data.initialReading = parseInt(data.initialReading);

  try {
    await machineService.create(data);
    alert("‚úÖ M√°quina creada correctamente");
    appLoad('machines/list.html');
  } catch (err) {
    alert("‚ùå Error al crear m√°quina: " + err.message);
  }
});
</script>